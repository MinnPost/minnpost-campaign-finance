/*! minnpost-campaign-finance - v0.0.0 - 2014-01-09
* https://github.com/minnpost/minnpost-campaign-finance
* Copyright (c) 2014 MinnPost; Licensed MIT */

define("helpers",["jquery","underscore","Backbone"],function(a,b,c){return{formatNumber:function(a,c){c=b.isUndefined(c)?2:c;var d=/(\d+)(\d{3})/;for(split=a.toFixed(c).toString().split(".");d.test(split[0]);)split[0]=split[0].replace(d,"$1,$2");return c?split[0]+"."+split[1]:split[0]},formatCurrency:function(a){return"$"+this.formatNumber(a,2)},formatPercent:function(a){return this.formatNumber(100*a,1)+"%"},formatPercentChange:function(a){return(a>0?"+":"")+this.formatPercent(a)},hash:function(a){return Math.abs(b.reduce(a.split(""),function(a,b){return a=(a<<5)-a+b.charCodeAt(0),a&a},0))},identifier:function(a){return a.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-").replace(/[^\w-]+/g,"")},isMSIE:function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},BackboneAJAX:function(){var a=arguments;return a[0].dataTypeForce!==!0&&(a[0].dataType="jsonp",a[0].jsonpCallback="mpServerSideCachingHelper"+b.hash(a[0].url)),c.$.ajax.apply(c.$,a)},jsonpRequest:function(){var c=arguments[0];return c.dataType="jsonp",c.jsonpCallback="mpServerSideCachingHelper"+b.hash(c.url),a.ajax.apply(a,[c])},getLocalData:function(c){var d=this,e=this.options.jsonpProxy,f=!1,g=[];return this.data=this.data||{},c=b.isArray(c)?c:[c],this.options&&0===this.options.dataPath.indexOf("http")&&(f=!0),b.each(c,function(c){var h;b.isUndefined(d.data[c])&&(h=f?this.jsonpRequest({url:e+encodeURI(d.options.dataPath+c+".json")}):a.getJSON(d.options.dataPath+c+".json"),a.when(h).done(function(a){d.data[c]=a}),g.push(h))}),a.when.apply(a,g)},getRemoteData:function(b){return b.dataType="jsonp",this.options.remoteProxy&&(b.url=b.url+"&callback=proxied_jqjsp",b.url=app.options.remoteProxy+encodeURIComponent(b.url),b.callback="proxied_jqjsp",b.cache=!0),a.ajax(b)}}}),define("models",["underscore","Backbone","helpers"],function(a,b,c){var d={};return b.ajax=c.BackboneAJAX,d.Base=b.Model.extend({initialize:function(a,b){this.options=b||{},this.app=b.app}}),d.Candidate=d.Base.extend({initialize:function(){d.Candidate.__super__.initialize.apply(this,arguments)}}),d}),define("collections",["underscore","Backbone","helpers","models"],function(a,b,c){var d={};return b.ajax=c.BackboneAJAX,d.Base=b.Collection.extend({initialize:function(a,b){this.options=b||{},this.app=b.app}}),d.Candidates=d.Base.extend({initialize:function(){d.Candidates.__super__.initialize.apply(this,arguments)}}),d}),define("views",["underscore","jquery","Ractive","Highcharts","helpers"],function(a,b,c,d,e){var f,g={};return g.Base=c.extend({baseInit:function(a){this.router=a.router}}),g.Application=g.Base.extend({init:function(){this.baseInit.apply(this,arguments)}}),g.Contests=g.Base.extend({init:function(){this.baseInit.apply(this,arguments),this.observe("contests",function(c){var d;a.isUndefined(c)||a.each(c,function(c){d=a.clone(f),d=b.extend(!0,d,{xAxis:{categories:c.candidates.pluck("candidate")},series:[{name:"Cash on hand",data:c.candidates.pluck("cashonhand")},{name:"Amount raised",data:c.candidates.pluck("amountraised")}],tooltip:{formatter:function(){return this.key+" <br /> "+this.series.name+": <strong>"+e.formatCurrency(this.y)+"</strong>"}}}),b(this.el).find(".chart-"+c.id).highcharts(d)},this)})}}),f={chart:{type:"bar",style:{fontFamily:'"HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif',color:"#BCBCBC"}},colors:["#1D71A5","#1DA595","#1DA551"],credits:{enabled:!1},title:{enabled:!1,text:""},legend:{borderWidth:0},plotOptions:{line:{lineWidth:4,states:{hover:{lineWidth:5}},marker:{fillColor:"#ffffff",lineWidth:2,lineColor:null,symbol:"circle",enabled:!1,states:{hover:{enabled:!0}}}}},xAxis:{title:{},minPadding:0,maxPadding:0,type:"category",labels:{formatter:function(){return this.value}}},yAxis:{title:{enabled:!1,text:"[Update me]",margin:40,style:{color:"inherit",fontWeight:"normal"}},min:0,gridLineColor:"#BCBCBC"},tooltip:{style:{},useHTML:!0,formatter:function(){return this.key+": <strong>"+this.y+"</strong>"}}},g}),define("text!templates/application.mustache",[],function(){return'<div class="message-container"></div>\n\n<div class="content-container">\n\n\n</div>\n\n<div class="footnote-container">\n  <div class="footnote">\n    <p>Some code, techniques, and data on <a href="https://github.com/zzolo/minnpost-campaign-finance" target="_blank">Github</a>.</p>\n  </div>\n</div>\n'}),define("text!templates/contests.mustache",[],function(){return'<div class="contests">\n\n  {{#contests}}\n    {{>contest}}\n  {{/contests}}\n\n</div>\n\n\n<!-- {{>contest}} -->\n<div class="contest {{ id }}">\n  <h4>{{ name }}</h4>\n\n  <div class="contest-chart chart-{{ id }}"></div>\n\n  <table>\n    <thead>\n      <tr>\n        <th>Candidate</th><th>Amount raised</th><th>Cash on hand</th>\n      </tr>\n    </thead>\n\n    <tbody>\n      {{#candidates}}\n        <tr>\n          <td>{{ candidate }}</td>\n          <td>{{ formatters.formatCurrency(amountraised) }}</td>\n          <td>{{ formatters.formatCurrency(cashonhand) }}</td>\n        </tr>\n      {{/candidates}}\n    </tbody>\n  </table>\n\n</div>\n<!-- {{/contest}} -->\n'}),define("text!templates/loading.mustache",[],function(){return'<div class="loading-container">\n  <div class="loading"><span>Loading...</span></div>\n</div>'}),define("routers",["underscore","Backbone","Ractive","Ractive-Backbone","helpers","models","collections","views","text!templates/application.mustache","text!templates/contests.mustache","text!templates/loading.mustache"],function(a,b,c,d,e,f,g,h,i,j,k){var l={};return l.Router=b.Router.extend({views:{},initialize:function(a){this.options=a,this.app=a.app,this.views.application=new h.Application({el:this.app.$el,template:i,data:{},router:this,partials:{loading:k},adaptors:["Backbone"]}),this.$contentEl=this.app.$el.find(".content-container")},routes:{contests:"routeContests","*default":"routeDefault"},start:function(){b.history.start()},routeDefault:function(){this.navigate("/contests",{trigger:!0,replace:!0})},routeContests:function(){this.views.contests=new h.Contests({el:this.$contentEl,template:j,data:{contests:this.app.contests,formatters:e},router:this,partials:{loading:k},adaptors:["Backbone"]})}}),l}),define("text!../data/campaign_finance_spreadsheet.json",[],function(){return'{"2014 Campaign Finances":[{"contest":"Governor","candidate":"Mark Dayton","incumbent":"Y","party":"DFL","amountraised":100000,"cashonhand":9999.38,"from":"","to":"","rowNumber":1},{"contest":"Governor","candidate":"Scott Honour","incumbent":"","party":"R","amountraised":999,"cashonhand":9,"from":"","to":"","rowNumber":2},{"contest":"Governor","candidate":"Kurt Zellers","incumbent":"","party":"R","amountraised":999,"cashonhand":9,"from":"","to":"","rowNumber":3},{"contest":"Senator","candidate":"Al Franken","incumbent":"Y","party":"D","amountraised":8576321.4,"cashonhand":3893286.11,"from":"7/1/2013","to":"9/30/2013","rowNumber":4},{"contest":"Senator","candidate":"Mike McFadden","incumbent":"","party":"R","amountraised":1468620.99,"cashonhand":1252087.2,"from":"7/1/2013","to":"9/30/2013","rowNumber":5},{"contest":"Senator","candidate":"Julianne Ortman","incumbent":"","party":"R","amountraised":119466,"cashonhand":88121.1,"from":"7/1/2013","to":"9/30/2013","rowNumber":6},{"contest":"Senator","candidate":"Jim Abeler","incumbent":"","party":"R","amountraised":54754,"cashonhand":34568.7,"from":"7/1/2013","to":"9/30/2013","rowNumber":7},{"contest":"Senator","candidate":"Chris Dahlberg","incumbent":"","party":"R","amountraised":"","cashonhand":"","from":"","to":"","rowNumber":8}]}'}),define("minnpost-campaign-finance",["underscore","helpers","routers","collections","text!../data/campaign_finance_spreadsheet.json"],function(a,b,c,d,e){var f=function(a){this.options=a,this.el=this.options.el,this.el&&(this.$el=$(this.el))};return a.extend(f.prototype,b),f.prototype.start=function(){this.loadData(),this.router=new c.Router({app:this}),this.router.start()},f.prototype.loadData=function(){var b=JSON.parse(e),c="2014 Campaign Finances";b=b[c],b=a.groupBy(b,"contest"),this.contests=[],a.each(b,function(a,b){var c={};c.name=b,c.id=this.identifier(b),c.candidates=new d.Candidates(a,{app:this}),this.contests.push(c)},this)},f});